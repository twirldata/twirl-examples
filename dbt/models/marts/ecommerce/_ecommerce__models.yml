version: 2

models:
  - name: fct_orders
    description: Fact table for orders with product details
    config:
      tags: 'ecommerce'
    columns:
      - name: purchase_id
        description: Unique identifier for each purchase
        data_tests:
          - unique
          - not_null
      - name: customer_id
        description: ID of the customer who made the purchase
      - name: product_id
        description: ID of the product purchased
      - name: quantity
        description: Quantity of the product purchased
      - name: total_price
        description: Total price of the purchase
      - name: purchased_at
        description: Timestamp of the purchase
      - name: product_name
        description: Name of the purchased product
      - name: product_category
        description: Category of the purchased product
      - name: unit_price
        description: Price per unit of the product
      - name: discount_amount
        description: Amount of discount applied to the purchase

  - name: dim_customers
    description: Dimension table for customers with order and event metrics
    config:
      tags: 'ecommerce'
    columns:
      - name: customer_id
        description: Unique identifier for each customer
        data_tests:
          - unique
          - not_null
      - name: first_order_date
        description: Date of the customer's first order
      - name: last_order_date
        description: Date of the customer's most recent order
      - name: total_orders
        description: Total number of orders placed by the customer
      - name: total_spent
        description: Total amount spent by the customer
      - name: total_events
        description: Total number of events associated with the customer
      - name: unique_event_types
        description: Number of unique event types associated with the customer

  - name: dim_products
    description: Dimension table for products with sales and view metrics
    config:
      tags: 'ecommerce'
    columns:
      - name: product_id
        description: Unique identifier for each product
        data_tests:
          - unique
          - not_null
      - name: product_name
        description: Name of the product
      - name: category
        description: Category of the product
      - name: price
        description: Current price of the product
      - name: total_orders
        description: Total number of orders for this product
      - name: total_quantity_sold
        description: Total quantity of this product sold
      - name: total_revenue
        description: Total revenue generated by this product
      - name: total_views
        description: Total number of pageviews for this product

  - name: fct_product_performance
    description: Fact table for daily product performance metrics
    config:
      tags: 'ecommerce'
    columns:
      - name: product_id
        description: ID of the product
      - name: date
        description: Date of the performance metrics
      - name: daily_orders
        description: Number of orders for the product on this date
      - name: daily_quantity_sold
        description: Quantity of the product sold on this date
      - name: daily_revenue
        description: Revenue generated by the product on this date
      - name: daily_views
        description: Number of pageviews for the product on this date
      - name: daily_events
        description: Number of events related to the product on this date
      - name: daily_unique_events
        description: Number of unique event types related to the product on this date
    data_tests:
      - unique:
          column_name: "product_id || '-' || date"
